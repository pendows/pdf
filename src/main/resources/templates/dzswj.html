<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:th="http://www.thymeleaf.org">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 

<meta name="viewport" content="width=device-width, initial-scale=1">
<title>国家税务总局广东省电子税务局</title>
<link rel="stylesheet" href="../static/style.css" type="text/css">
<!--bootstrap css  -->
<link rel="stylesheet" href="../static/bootstrap.css" type="text/css">
<script type="text/javascript" src="../static/verifyCode.js"></script>
<script type="text/javascript" src="../static/jQuery.js"></script>
<script type="text/javascript" src="../static/bootstrap.js"></script>
<link rel="stylesheet" href="../static/Message.css" type="text/css">
<script type="text/javascript" src="../static/Message.js"></script>
<script language="JavaScript" src="../static/jquery.blockUI.js"></script>
<script language="JavaScript" src="../static/asyncontrol.js"></script>
	<script src="../jQuery.js"></script>
	<script language="JavaScript" src="../static/WdatePicker.js">
	</script><link href="../static/WdatePicker.css" rel="stylesheet" type="text/css">

<script th:inline="javascript">
    /* 加载页面时，第一个文本框获取焦点 */
    window.onload = function() {
        document.getElementById("spzb1").focus();
    }

	var fileId = [[${fileId}]];
	console.log(fileId)

	$.ajax({
		type: "POST",
		url: "/pdf/getFileContent",
		data: {id:fileId},
		dataType: "json",
		success: function(data){
			if(data.err == "error") {
				return false;
			} else {
				$("#tfrq").var(data.fileDate);
				$("#hjje").var(data.fileAmount);
				$("#spzh").var(data.fileNo);
				$("#tfrq").var(data.fileDate);
			}
		}
	});

    /* 提交查验前校验参数 */
    var isSubmiting = false;
    function btn_tj() {
        if(isSubmiting) {
            alert("请刷新界面后再提交您的申请！");
            return false;
        }


        //判断填发日期为空
        if(document.formCy.tfrq.value == "") {
            alert("请输入填发日期!");
            document.formCy.tfrq.focus();
            return false;
        }
        //判断金额是否为空
        if (document.formCy.hjje.value.replace(/(^\s*)|(\s*$)/g, "") == "") {
            alert("请输入金额合计！");
            document.formCy.hjje.focus();
            return false;
        }

        if($('#spzh').val()==''||$('#spzh').val()==undefined){
            //判断电子税票号码是否为空、
            if(document.formCy.spbh.value == "") {//税票编号为空
                alert("请填写完整的税收票证字号!");
                document.formCy.spbh.focus();
                return false;
            }
            if(document.formCy.spzb1.value == "" && document.formCy.spbh.value == "") {//税票字轨和税票编号都为空
                alert("请填写完整的税收票证字号!");
                document.formCy.spzb1.focus();
                return false;
            }
        }


        if(document.getElementById("veryCode")) {//有验证码表单元素则要验证码
            //判断验证码是否为空
            if (document.formCy.veryCode.value.replace(/(^\s*)|(\s*$)/g, "") == "") {
                alert("请输入验证码！");
                document.formCy.veryCode.focus();
                return false;
            } else {

            }
        }


        /* 提交查验 */
        isSubmiting =  true;
        var spzh;
        var spbh;
        var spzb1;
        var spzb2;
        if(isSubmiting) {
            //验证码不为空
            if(document.getElementById("veryCode")) { //有验证码表单元素则要验证码

                var tfrq = document.formCy.tfrq.value;
                if(parseInt(tfrq.substr(0,4))>=2019){
                    //19年以后采用新规则字号
                    spzh = $('#spzh').val();
                    spzh = spzh.replace("No","");
                    if(spzh.length==15){
                        //若15位则判断为清单
						spzb="个税纳税清单";
						spbh = spzh;
					}else{
                        spbh = spzh.substr(spzh.length-8);
                        spzb = spzh.substr(0,spzh.length-8);
					}
                }else{
                    spzb1 = $('#spzb1').val();
                    spzb2 = $('#spzb2').val();
                    if(spzb2=="个税纳税清单"){
                        spzb = spzb2;
                    }else{
                        spzb = "("+spzb1+")"+spzb2;
                    }
                    spbh = $('#spbh').val();
                }
				//fsAsynDataLoader.blockPage('正在加载数据，请您稍等...');
				//window.open("http://127.0.0.1/pdf/generateQR");
                //合计金额
                /*var hjje = document.formCy.hjje.value.replace(/(^\s*)|(\s*$)/g, "");
                var veryCode = document.formCy.veryCode.value
                fsAsynDataLoader.blockPage('正在加载数据，请您稍等...');
                $.ajax({
                    type: "POST",
                    url: "/etax/dzsp/dzspdy/dzspCy.do",
                    data: {spzb:spzb,spbh:spbh,tfrq:tfrq,hjje:hjje,veryCode:veryCode},
                    dataType: "json",
                    success: function(data){
                        if(data.err == "error") {
                            fsAsynDataLoader.unBlockPage();
                            window.location.href = "/etax/dzsp/dzspdy/yzmError.do";
                            return false;
                        } else {

                            fsAsynDataLoader.unBlockPage();
							window.onload = function (){
								var myPDF = new PDFObject({ url: "http://demo.lanrenzhijia.com/2014/pdf1023/sample.pdf" }).embed();
							};
                            window.location.href = "/etax/dzsp/dzspdy/dzspCy2.do?tid="+data.tid;
                        }
                    }
                });*/
            } else {//验证码为空
                //税票字别

                var tfrq = document.formCy.tfrq.value;
                if(parseInt(tfrq.substr(0,4))>=2019){
                    //19年以后采用新规则字号
                    spzh = $('#spzh').val();
                    spzh = spzh.replace("No","");
                    if(spzh.length==15){
                        //若15位则判断为清单
                        spzb="个税纳税清单";
                        spbh = spzh;
                    }else{
                        spbh = spzh.substr(spzh.length-8);
                        spzb = spzh.substr(0,spzh.length-8);
                    }
                }else{
                    spzb1 = $('#spzb1').val();
                    spzb2 = $('#spzb2').val();
                    if(spzb2=="个税纳税清单"){
                         spzb = spzb2;
                    }else{
                        spzb = "("+spzb1+")"+spzb2;
                    }
                    spbh = $('#spbh').val();
                }

                //合计金额
                var hjje = document.formCy.hjje.value.replace(/(^\s*)|(\s*$)/g, "");

                fsAsynDataLoader.blockPage('正在加载数据，请您稍等...');
                $.ajax({
                    type: "POST",
                    url: "/etax/dzsp/dzspdy/dzspCy.do",
                    data: {spzb:spzb,spbh:spbh,tfrq:tfrq,hjje:hjje},
                    dataType: "json",
                    success: function(data){
                        fsAsynDataLoader.unBlockPage();
                        window.location.href = "/etax/dzsp/dzspdy/dzspCy2.do?tid="+data.tid;
                    }
                });
            }
        }
    }

    function isMobile()  {
        var userAgentInfo = navigator.userAgent.toLowerCase();
        var Agents = new Array("android", "iphone", "symbianos", "windows phone", "ipad", "ipod", "ucweb");
        var flag = false;
        for (var v = 0; v < Agents.length; v++) {
            if (userAgentInfo.indexOf(Agents[v]) > 0) { flag = true; break; }
        }
        return flag;
    }
    function spzbChange(){
        var isgsqd = $('#spzb2').val();
        if(isgsqd=="个税纳税清单"){
            $('#namespzh').text("查验码：");
            $('#spzbhm').hide();
        }else{
            $('#spzbhm').show();
            $('#namespzh').text("税票字号：");
        }
    }
    function  tfrqChange() {
        var tfrq  = $('#tfrq').val();
        var year = tfrq.substr(0,4);
        if(parseInt(year)>=2019){
            $('#spzbhm').hide();
            $('#spzb1').hide();
            $('#spzb2').hide();
            $('#spbh').hide();
            $('#spzh').show();

        }else{
            $('#spzbhm').show();
            $('#spzb1').show();
            $('#spzb2').show();
            $('#spbh').show();
            $('#spzh').hide();
        }

    }
	
</script>  
<script type="text/javascript">
$(function(){
	 if(isMobile()){
	 	$("#iframeofall").css("width","100%");
	 }
	 if(null!=document.getElementById("imgObj") && ''!=document.getElementById("imgObj")){
	 	document.getElementById("imgObj").src="/etax/DrawImage?random="+Math.random();
	 }
})

</script>

</head>
<body>
<input type="hidden" th:value="${fileId}" id="fileId">
  <form name="formCy" id="formCy" method="get">
  <div style="text-align:center">
    <div class="div-gdsite-01-iframe-01" id="iframeofall">
	  <h1>广东省电子税务局&gt;&gt;电子税票查验</h1>
	  <table width="100%" border="0" cellspacing="1" cellpadding="0">
		  <tbody><tr>
			  <td align="right" class="td02-gdsite-01-table-01" width="100px">填发日期：</td>
			  <td align="left" width="180px">
				  <input name="tfrq" id="tfrq" type="text" onchange="tfrqChange()" readonly="true" onfocus="WdatePicker()" class="input1-gdsite-01-table-01" size="25" maxlength="25" value="2020-08-31">
			  </td>
			  <td colspan="3">
			  </td>
		  </tr>

		  <tr>
			  <td align="right" class="td02-gdsite-01-table-01">金额合计：</td>
			  <td align="left" colspan="4"><input name="hjje" id="hjje" type="text" class="input1-gdsite-01-table-01" size="25" maxlength="25" onkeypress="return  ((event.keyCode&gt;=48 &amp;&amp; event.keyCode&lt;=57) || event.keyCode == 46)" onpaste="return !clipboardData.getData(&#39;text&#39;).match(/\D/)" ondragenter="return false" value="2024.12">
			  </td>
		  </tr>
	    <tr>
	      <td align="right" class="td02-gdsite-01-table-01" id="namespzh">税票字号：</td>
	      
	      <td align="left" width="50%">
	      <span id="spzbhm" style="display: none;">(
	      	<input id="spzb1" name="spzb1" maxlength="3" class="input1-gdsite-01-table-01" style="width: 11%; border-width: 0px 0px 1px; border-style: initial; border-color: initial; display: none;" type="text">
	  			)</span>
	  			
	      		<select class="input1-gdsite-01-table-01" id="spzb2" name="spzb2" onchange="spzbChange()" style="display: none;">
	      			<option value="粤地证">粤地证</option>
                    <option value="粤国证明">粤国证明</option>
                    <option value="粤地证明">粤地证明</option>
	      			<option value="粤地电证">粤地电证</option>
	      			<option value="粤地电证明">粤地电证明</option>
	      			<option value="个税纳税清单">个税纳税清单</option>
	      		</select>
              <input placeholder="税票编号" name="spbh" id="spbh" type="text" class="input1-gdsite-01-table-01" style="border-left: 0px; border-top: 0px; border-right: 0px; display: none;" size="16" maxlength="16">
              <input placeholder="税票字号" name="spzh" id="spzh" type="text" class="input1-gdsite-01-table-01" style="border-left: 0px; border-top: 0px; border-right: 0px;" size="23" maxlength="20">
          </td>
			  <script type="text/javascript">
		var pzzl = "2"
		var spzb = "20（0831）44证明";
        var tfrq = "2020-08-31";
        var spbh = "60010316";
        var year = parseInt(tfrq.substring(0,4));
		if(year>=2019){
		    var spzh ="";
		    if(pzzl == 7){
				spzh = spbh;
			}else{
                 spzh = spzb+spbh;
            }
		    $('#spzh').val(spzh);
            $('#spzbhm').hide();
            $('#spzb1').hide();
            $('#spzb2').hide();
            $('#spbh').hide();
            $('#spzh').show();
          /*  var spzb1 = spzb.substring(1, 4);
            var spzb2	=spzb.substring(5, spzb.length);*/
		}else {
            if (pzzl == 7) {
                var spzb1 = "";
                var spzb2 = spzb;
                $('#spzbhm').hide();
                $('#namezpzh').text("查验码：");
            } else {
                var spzb1 = spzb.substring(1, 4);
                var spzb2 = spzb.substring(5, spzb.length);
                $('#spbh').val(spbh);
            }
            document.formCy.spzb1.value=spzb1;
            document.formCy.spzb2.value=spzb2;
        }

		 //alert(document.formCy.spzb2.value)
		// alert(document.formCy.spzb1.value)
		</script>	   
	     <!--  <td width="180px">
	      	<font  color="red" style="font-size:14px;">（样例：（161）粤地电证）</font>
	      </td> -->
	  

	         	
	     </tr>
	     <tr>
	     <td align="right" class="td02-gdsite-01-table-01" width="100px;">说明：</td>
			 <td align="left">
	      	      <!-- <span   colspan="4" align="left" >1.下拉菜单选<font  color="red">粤地电证</font>或<font  color="red">粤地电证明</font>的，录入税票字号；2.选<font  color="red">个税纳税清单</font>的，录入查验码。</span> -->
				  <span colspan="4" align="left">
					  1、查验个税纳税清单的，录入查验码；<br>
2、查验中央非税收入统一票据的，录入8位票据代码+10位票据号码；<br>
3、其他的录入税票字号；<br>
4、2019-01-01以后生成表格式票证输入18位字号码。
				  </span>
<!-- 	      <img alt="图片为显示" src="/skin/etax/style/dzsp/image/spzg.bmp" width="180px" height="30">
 -->	      <!-- 	<font  color="red" style="font-size:14px;">（样例：12345678）</font> -->
		  </td>	
	     </tr>

		  <tr>
			  <td align="right" class="td02-gdsite-01-table-01">验证码：</td>
			  <td align="left">
				  <input type="text" id="veryCode" name="veryCode" class="input1-gdsite-01-table-01" size="25" maxlength="4" value="">

				  <img id="imgObj" onclick="changeImg()" style="cursor:pointer;" src="/etax/DrawImage?random=0.7603080892876732">
			  </td>
			  <td colspan="1" align="left">
				  <a href="#" onclick="changeImg()">换一张</a>
			  </td>
		  </tr>


		<tr>
		 <td colspan="1" align="center">
		 	<span class="font02" onclick="btn_tj()" style="cursor:pointer;">查验 </span>  
		 </td>
		 <td colspan="1" style="color:red;font-size: 14px;padding-left:10px;padding-top:10px;" align="left">请确认查验网站为http://www.gd-n-tax.gov.cn并核对票面信息后查验</td>
		 </tr>
	  </tbody></table>
	</div>
</div>
  </form>




<div><div id="maskLevel" style="position:absolute;top:0;left:0;display:none;text-align:center;z-index:10000;"></div><div id="msg-window" style="position:absolute;z-index:10001;display:none"><div class="msg-tl" id="msg-tl"><div class="msg-tr"><div class="msg-tc" style="cursor:move;"><div class="msg-header-text"></div><div class="msg-header-tools"><div class="Message_min" title="最小化"><strong>0</strong></div><div class="Message_max" title="最大化"><strong>1</strong></div><div class="Message_close" title="关闭"><strong>r</strong></div></div></div></div></div><div class="msg-ml" id="msg-ml"><div class="msg-mr"><div class="msg-mc"><div class="msg-body" style="position:relative"></div></div></div></div><div class="msg-ml" id="msg-btnl"><div class="msg-mr"><div class="msg-btn"></div></div></div><div class="msg-bl" id="msg-bl"><div class="msg-br"><div class="msg-bc"></div></div></div></div></div><div style="position: absolute; z-index: 19700; top: -1970px; left: -1970px;"><iframe src="/My97DatePicker.html" frameborder="0" border="0" scrolling="no" style="width: 186px; height: 198px;"></iframe></div></body></html>
